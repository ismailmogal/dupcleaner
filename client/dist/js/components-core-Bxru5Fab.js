var e=Object.defineProperty,s=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(s,t,i)=>t in s?e(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,n=(e,s,t)=>new Promise((i,a)=>{var l=e=>{try{n(t.next(e))}catch(s){a(s)}},r=e=>{try{n(t.throw(e))}catch(s){a(s)}},n=e=>e.done?i(e.value):Promise.resolve(e.value).then(l,r);n((t=t.apply(e,s)).next())});import{D as c}from"./duplicate-detection-DgkP5tI1.js";import{r as o,g as d}from"./vendor-react-DEQ385Nk.js";import{u as m}from"./contexts-DVWjs8vK.js";var h,u,f={exports:{}},p={};var x=(u||(u=1,f.exports=function(){if(h)return p;h=1;var e=o(),s=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function r(e,t,r){var n,c={},o=null,d=null;for(n in void 0!==r&&(o=""+r),void 0!==t.key&&(o=""+t.key),void 0!==t.ref&&(d=t.ref),t)i.call(t,n)&&!l.hasOwnProperty(n)&&(c[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===c[n]&&(c[n]=t[n]);return{$$typeof:s,type:e,key:o,ref:d,props:c,_owner:a.current}}return p.Fragment=t,p.jsx=r,p.jsxs=r,p}()),f.exports),v=o();const j=d(v);const g=Object.freeze(Object.defineProperty({__proto__:null,default:function({files:e,onDeleteFiles:o,currentFolder:d,onFolderClick:m}){const[h,u]=v.useState([]),[f,p]=v.useState(new Set),[j,g]=v.useState({exact:!0,similar:!0,size:!0,hash:!1}),[w,N]=v.useState(!1),[b,y]=v.useState(!1),[S,k]=v.useState({current:0,total:0,fileName:""}),C=v.useMemo(()=>new c,[]),F=v.useCallback(()=>n(null,null,function*(){N(!0);try{const s=Object.keys(j).filter(e=>j[e]);if(0===e.length)return void u([]);const t=yield C.findAllDuplicates(e,s);u(t)}catch(s){u([])}finally{N(!1)}}),[e,j,C]);v.useEffect(()=>{e.length>0?F():u([])},[F,e.length]);const z=e=>{switch(e){case"exact":return"Exact Match";case"similar":return"Similar Names";case"size":return"Same Size";case"hash":return"Hash Match";default:return e}},D=e=>{switch(e){case"exact":return"Files with identical names and sizes";case"similar":return"Files with similar names (80% similarity)";case"size":return"Files with identical sizes";case"hash":return"Files with identical content hashes";default:return""}};return w?x.jsx("div",{className:"duplicate-manager",children:x.jsxs("div",{className:"scanning-indicator",children:[x.jsx("div",{className:"spinner"}),x.jsx("p",{children:"Scanning for duplicates..."})]})}):x.jsxs("div",{className:"duplicate-manager",children:[x.jsxs("div",{className:"duplicate-header",children:[x.jsx("h2",{children:"Duplicate File Manager"}),x.jsxs("div",{className:"current-location",children:[x.jsxs("p",{children:["Current Location: ",x.jsx("strong",{children:d?d.name:"Root Folder"})]}),d&&x.jsx("button",{className:"nav-button",onClick:()=>m(null),children:"← Back to Root"})]}),x.jsxs("div",{className:"detection-methods",children:[x.jsx("h3",{children:"Detection Methods:"}),Object.entries(j).map(([e,n])=>x.jsxs("label",{className:"method-checkbox",children:[x.jsx("input",{type:"checkbox",checked:n,onChange:n=>g(c=>{return o=((e,s)=>{for(var t in s||(s={}))a.call(s,t)&&r(e,t,s[t]);if(i)for(var t of i(s))l.call(s,t)&&r(e,t,s[t]);return e})({},c),d={[e]:n.target.checked},s(o,t(d));var o,d})}),z(e)]},e))]})]}),x.jsxs("div",{className:"duplicate-stats",children:[x.jsxs("p",{children:["Found ",h.length," duplicate groups"]}),x.jsxs("p",{children:["Selected ",f.size," files for deletion"]}),f.size>0&&x.jsx("button",{className:"delete-button",onClick:()=>n(null,null,function*(){if(0===f.size)return;const s=Array.from(f).map(s=>e.find(e=>e.id===s)).filter(Boolean),t=s.reduce((e,s)=>e+s.size,0);if(window.confirm(`Are you sure you want to delete ${s.length} files? This will free up ${C.formatFileSize(t)} of space.`)){y(!0),k({current:0,total:s.length,fileName:"Starting deletion..."});try{k({current:0,total:s.length,fileName:"Starting deletion..."});const e=yield o(s,(e,s,t)=>{k({current:e,total:s,fileName:t})});p(new Set),alert(`Successfully deleted ${e.length} files and freed ${C.formatFileSize(t)} of space!`),window.location.reload()}catch(i){alert(`Error deleting files: ${i.message}`)}finally{y(!1),k({current:0,total:0,fileName:""})}}}),disabled:b,children:b?`Deleting... (${S.current}/${S.total})`:"Delete Selected Files"})]}),x.jsx("div",{className:"duplicate-groups",children:h.map((e,s)=>x.jsxs("div",{className:"duplicate-group",children:[x.jsxs("div",{className:"group-header",children:[x.jsxs("div",{className:"group-info",children:[x.jsx("h3",{children:z(e.method)}),x.jsx("p",{children:D(e.method)}),x.jsxs("p",{children:[e.files.length," files • ",C.formatFileSize(e.totalSize)]})]}),x.jsxs("label",{className:"group-select",children:[x.jsx("input",{type:"checkbox",checked:e.files.every(e=>f.has(e.id)),onChange:e=>((e,s)=>{const t=new Set(f);h[e].files.forEach(e=>{s?t.add(e.id):t.delete(e.id)}),p(t)})(s,e.target.checked)}),"Select All"]})]}),x.jsx("div",{className:"file-list",children:e.files.map((e,s)=>x.jsxs("div",{className:"file-item",children:[x.jsx("label",{className:"file-select",children:x.jsx("input",{type:"checkbox",checked:f.has(e.id),onChange:s=>((e,s)=>{const t=new Set(f);s?t.add(e):t.delete(e),p(t)})(e.id,s.target.checked)})}),x.jsxs("div",{className:"file-info",children:[x.jsx("span",{className:"file-name",children:e.name}),x.jsx("span",{className:"file-size",children:C.formatFileSize(e.size)}),x.jsx("span",{className:"file-date",children:new Date(e.lastModifiedDateTime).toLocaleDateString()})]})]},e.id))})]},s))}),0===h.length&&x.jsxs("div",{className:"no-duplicates",children:[x.jsx("p",{children:"No duplicate files found with the selected detection methods."}),d&&x.jsx("p",{children:"Try navigating to a different folder or adjusting the detection methods."})]})]})}},Symbol.toStringTag,{value:"Module"}));function w({files:e,currentFolder:s,folderPath:t,onFolderClick:i,onBreadcrumbClick:a,onFileSelect:l,selectedFiles:r,onAddToComparison:n,defaultViewMode:c="grid",showFileSizes:o=!0,showFileDates:d=!0,compactMode:h=!1}){const{userPreferences:u,updatePreferences:f}=m(),[p,g]=v.useState([]),[w,N]=v.useState([]),[b,y]=v.useState(u.fileBrowserViewMode||c),[S,k]=v.useState("name"),[C,F]=v.useState("asc");v.useEffect(()=>{if(e&&e.length>0){const s=e.filter(e=>e.folder),t=e.filter(e=>!e.folder);g(s),N(t)}else g([]),N([])},[e]),v.useEffect(()=>{y(u.fileBrowserViewMode||c)},[u.fileBrowserViewMode,c]);const z=e=>{i(e)},D=e=>{l(e)},M=e=>{a(e)},O=e=>{if(0===e)return"0 Bytes";const s=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,s)).toFixed(2))+" "+["Bytes","KB","MB","GB"][s]},_=e=>{var s;if(e.folder)return"📁";switch(null==(s=e.name.split(".").pop())?void 0:s.toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"🖼️";case"mp4":case"avi":case"mov":case"wmv":return"🎥";case"mp3":case"wav":case"flac":return"🎵";case"pdf":default:return"📄";case"doc":case"docx":return"📝";case"xls":case"xlsx":return"📊";case"ppt":case"pptx":return"📈";case"zip":case"rar":case"7z":return"📦"}},P=e=>{var s;if(e.folder)return"Folder";switch(null==(s=e.name.split(".").pop())?void 0:s.toLowerCase()){case"jpg":case"jpeg":case"png":case"gif":case"bmp":return"Image";case"mp4":case"avi":case"mov":case"wmv":return"Video";case"mp3":case"wav":case"flac":return"Audio";case"pdf":return"PDF Document";case"doc":case"docx":return"Word Document";case"xls":case"xlsx":return"Excel Spreadsheet";case"ppt":case"pptx":return"PowerPoint Presentation";case"zip":case"rar":case"7z":return"Compressed Folder";default:return"File"}},$=e=>[...e].sort((e,s)=>{let t,i;switch(S){case"name":default:t=e.name.toLowerCase(),i=s.name.toLowerCase();break;case"size":t=e.size||0,i=s.size||0;break;case"date":t=new Date(e.lastModifiedDateTime),i=new Date(s.lastModifiedDateTime);break;case"type":t=P(e),i=P(s)}return"asc"===C?t>i?1:-1:t<i?1:-1}),E=e=>{S===e?F("asc"===C?"desc":"asc"):(k(e),F("asc"))},L=e=>{y(e),f({fileBrowserViewMode:e})},B=(e,s)=>x.jsx("div",{className:"items-grid",children:e.map(e=>x.jsxs("div",{className:`${s}-item`,onClick:()=>"folder"===s?z(e):D(e),children:[x.jsx("div",{className:"item-icon",children:_(e)}),x.jsx("div",{className:"item-name",children:e.name}),o&&x.jsx("div",{className:"item-info",children:"folder"===s?`${e.childCount||0} items`:O(e.size)}),"folder"===s&&n&&x.jsx("button",{className:"add-to-comparison-btn",onClick:s=>{s.stopPropagation(),n(e)},title:"Add to comparison",children:"+"}),"file"===s&&r.has(e.id)&&x.jsx("div",{className:"selection-indicator",children:"✓"})]},e.id))}),T=(e,s)=>x.jsx("div",{className:"items-list",children:e.map(e=>x.jsxs("div",{className:"list-item "+("file"===s&&r.has(e.id)?"selected":""),onClick:()=>"folder"===s?z(e):D(e),children:[x.jsx("div",{className:"list-item-icon",children:_(e)}),x.jsx("div",{className:"list-item-name",children:e.name}),x.jsx("div",{className:"list-item-type",children:P(e)}),o&&x.jsx("div",{className:"list-item-size",children:"folder"===s?`${e.childCount||0} items`:O(e.size)}),d&&x.jsx("div",{className:"list-item-date",children:new Date(e.lastModifiedDateTime).toLocaleDateString()}),"folder"===s&&n&&x.jsx("button",{className:"add-to-comparison-btn list-btn",onClick:s=>{s.stopPropagation(),n(e)},title:"Add to comparison",children:"+"})]},e.id))}),A=(e,s)=>{const t="folder"===s&&n,i=`details-header${o?" show-size":""}${d?" show-date":""}${t?" show-actions":""}`,a=`details-item${o?" show-size":""}${d?" show-date":""}${t?" show-actions":""}`;return x.jsxs("div",{className:"items-details",children:[x.jsxs("div",{className:i,children:[x.jsxs("div",{className:"details-column",onClick:()=>E("name"),children:["Name ","name"===S&&("asc"===C?"↑":"↓")]}),x.jsxs("div",{className:"details-column",onClick:()=>E("type"),children:["Type ","type"===S&&("asc"===C?"↑":"↓")]}),o&&x.jsxs("div",{className:"details-column",onClick:()=>E("size"),children:["Size ","size"===S&&("asc"===C?"↑":"↓")]}),d&&x.jsxs("div",{className:"details-column",onClick:()=>E("date"),children:["Date Modified ","date"===S&&("asc"===C?"↑":"↓")]}),"folder"===s&&n&&x.jsx("div",{className:"details-column-actions",children:"Actions"})]}),x.jsx("div",{className:"details-content",children:e.map(e=>x.jsxs("div",{className:`${a} ${"file"===s&&r.has(e.id)?"selected":""}`,onClick:()=>"folder"===s?z(e):D(e),children:[x.jsx("div",{className:"details-item-icon",children:_(e)}),x.jsx("div",{className:"details-item-name",children:e.name}),x.jsx("div",{className:"details-item-type",children:P(e)}),o&&x.jsx("div",{className:"details-item-size",children:"folder"===s?`${e.childCount||0} items`:O(e.size)}),d&&x.jsx("div",{className:"details-item-date",children:new Date(e.lastModifiedDateTime).toLocaleDateString()}),"folder"===s&&n&&x.jsx("div",{className:"details-item-actions",children:x.jsx("button",{className:"add-to-comparison-btn details-btn",onClick:s=>{s.stopPropagation(),n(e)},title:"Add to comparison",children:"+"})})]},e.id))})]})},R=$(p),V=$(w);return x.jsxs("div",{className:"file-browser "+(h?"compact-mode":""),children:[x.jsxs("div",{className:"browser-header",children:[x.jsx("h3",{children:"File Browser"}),x.jsxs("div",{className:"browser-controls",children:[x.jsxs("div",{className:"breadcrumbs",children:[x.jsx("span",{className:"breadcrumb-item clickable",onClick:()=>M(-1),children:"🏠 OneDrive"}),t.map((e,s)=>x.jsxs(j.Fragment,{children:[x.jsx("span",{className:"breadcrumb-separator",children:"/"}),x.jsx("span",{className:"breadcrumb-item "+(s===t.length-1?"current":"clickable"),onClick:()=>M(s),children:e.name})]},s))]}),x.jsxs("div",{className:"view-controls",children:[x.jsx("button",{className:"view-button "+("grid"===b?"active":""),onClick:()=>L("grid"),title:"Grid View",children:"⊞"}),x.jsx("button",{className:"view-button "+("list"===b?"active":""),onClick:()=>L("list"),title:"List View",children:"☰"}),x.jsx("button",{className:"view-button "+("details"===b?"active":""),onClick:()=>L("details"),title:"Details View",children:"≡"})]})]})]}),x.jsxs("div",{className:"browser-content",children:[x.jsxs("div",{className:"folders-section",children:[x.jsxs("h4",{children:["Folders (",p.length,")"]}),p.length>0?"grid"===b?B(R,"folder"):"list"===b?T(R,"folder"):A(R,"folder"):x.jsx("p",{className:"no-items",children:"No folders in this location"})]}),x.jsxs("div",{className:"files-section",children:[x.jsxs("h4",{children:["Files (",w.length,")"]}),w.length>0?"grid"===b?B(V,"file"):"list"===b?T(V,"file"):A(V,"file"):x.jsx("p",{className:"no-items",children:"No files in this location"})]})]})]})}const N=Object.freeze(Object.defineProperty({__proto__:null,default:w},Symbol.toStringTag,{value:"Module"}));function b({onFetchFolderFiles:e,onFolderSelect:s,onClose:t}){const{userPreferences:i}=m(),[a,l]=v.useState(null),[r,c]=v.useState([]),[o,d]=v.useState([]),[h,u]=v.useState(!0),[f,p]=v.useState(!1),[j,g]=v.useState(!1),[N,b]=v.useState({width:1e3,height:700}),[y,S]=v.useState({x:0,y:0}),k=v.useRef(null),C=v.useRef(null),F=v.useCallback(()=>{try{const e=localStorage.getItem("folderSelector_size");if(e){return JSON.parse(e)}}catch(e){}return{width:1e3,height:700}},[]),z=v.useCallback(e=>{try{localStorage.setItem("folderSelector_size",JSON.stringify(e))}catch(s){}},[]),D=v.useCallback(()=>{try{const e=localStorage.getItem("folderSelector_state");if(e){return JSON.parse(e)}}catch(e){}return null},[]),M=v.useCallback((e,s)=>{try{const t={currentFolder:e,folderPath:s,timestamp:Date.now()};localStorage.setItem("folderSelector_state",JSON.stringify(t))}catch(t){}},[]);v.useEffect(()=>{const e=F();b(e)},[F]);const O=v.useCallback(e=>{if(e.target.closest(".header-controls"))return;e.preventDefault(),g(!0);const s=e.clientX-y.x,t=e.clientY-y.y,i=e=>{if(!j)return;const i=e.clientX-s,a=e.clientY-t,l=window.innerWidth-N.width,r=window.innerHeight-N.height;S({x:Math.max(0,Math.min(l,i)),y:Math.max(0,Math.min(r,a))})},a=()=>{g(!1),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)},[j,y,N]),_=v.useCallback(e=>{e.preventDefault(),p(!0);const s=e.clientX,t=e.clientY,i=N.width,a=N.height,l=e=>{if(!f)return;const l=e.clientX-s,r=e.clientY-t,n=Math.max(600,Math.min(1200,i+l)),c=Math.max(400,Math.min(800,a+r));b({width:n,height:c})},r=()=>{p(!1),z(N),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",r)};document.addEventListener("mousemove",l),document.addEventListener("mouseup",r)},[f,N,z]),P=v.useCallback(()=>n(null,null,function*(){try{u(!0);const s=yield e("root");d(s),l({id:"root",name:"OneDrive"}),c([{id:"root",name:"OneDrive"}])}catch(s){}finally{u(!1)}}),[e]),$=v.useCallback(s=>n(null,null,function*(){try{u(!0);const t=yield e(s.currentFolder.id);d(t),l(s.currentFolder),c(s.folderPath)}catch(t){yield P()}finally{u(!1)}}),[e,P]);v.useEffect(()=>{const e=D(),s=e&&Date.now()-e.timestamp<864e5;e&&s?$(e):P()},[D,$,P]);return h?x.jsx("div",{className:"folder-selector-overlay",children:x.jsx("div",{className:"folder-selector",style:{width:N.width,height:N.height},children:x.jsxs("div",{className:"loading-indicator",children:[x.jsx("div",{className:"spinner"}),x.jsx("p",{children:"Loading folders..."})]})})}):x.jsx("div",{className:"folder-selector-overlay",children:x.jsxs("div",{ref:k,className:`folder-selector ${f?"resizing":""} ${j?"dragging":""}`,style:{width:N.width,height:N.height,minWidth:600,minHeight:400,maxWidth:"90vw",maxHeight:"90vh",transform:`translate(${y.x}px, ${y.y}px)`},children:[x.jsxs("div",{className:"selector-header",onMouseDown:O,children:[x.jsx("h3",{children:"Select Folder for Comparison"}),x.jsxs("div",{className:"header-controls",children:[x.jsx("button",{className:"reset-size-btn",onClick:()=>{(()=>{const e={width:1e3,height:700};b(e),z(e)})(),S({x:0,y:0})},title:"Reset to default size and position",children:"↺"}),x.jsx("button",{className:"close-button",onClick:()=>{localStorage.removeItem("folderSelector_state"),t()},children:"×"})]})]}),x.jsx("div",{className:"selector-content",children:x.jsx(w,{files:o,currentFolder:a,folderPath:r,onFolderClick:s=>n(null,null,function*(){try{u(!0);const t=yield e(s.id);d(t),l(s);const i=[...r,s];c(i),M(s,i)}catch(t){}finally{u(!1)}}),onBreadcrumbClick:s=>n(null,null,function*(){try{let t,i;if(u(!0),-1===s){const s=yield e("root");return d(s),l({id:"root",name:"OneDrive"}),c([{id:"root",name:"OneDrive"}]),void M({id:"root",name:"OneDrive"},[{id:"root",name:"OneDrive"}])}t=r[s],i=r.slice(0,s+1);const a=yield e(t.id);d(a),l(t),c(i),M(t,i)}catch(t){}finally{u(!1)}}),onFileSelect:()=>{},selectedFiles:new Set,onAddToComparison:e=>{s(e),t()},defaultViewMode:i.fileBrowserViewMode,showFileSizes:i.showFileSizes,showFileDates:i.showFileDates,compactMode:i.compactMode})}),x.jsx("div",{ref:C,className:"resize-handle",onMouseDown:_,title:"Drag to resize",children:x.jsx("div",{className:"resize-indicator",children:"⋮⋮"})})]})})}export{g as D,b as F,j as R,N as a,x as j,v as r};
